<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html>
<head>
	<title>refNum &rsaquo; Quilt &rsaquo; Xcode</title>
	<!--HEAD_BEGIN-->
	<meta http-equiv="Content-Type" content="text/html; charset=UTF8">
	
	

	

	<script type="text/javascript" src="src/js/refnum.js"></script>

	<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">_uacct = "UA-1732444-2";urchinTracker();</script>

	<link type="text/css" href="src/css/refnum.css" rel=stylesheet>
	<!--HEAD_END-->
</head>
<body>

<div id="content">
<!--#include virtual="/src/inc/nav.inc" -->
<script language="javascript">navSelect("dev")</script>

<a href="index.html">
<div id="page_strap_frame"   style="background:url('src/img/page_strap_quilt.png');">
<div id="page_strap_content" style="background:url('src/img/page_strap_quilt.jpg'); background-repeat: no-repeat; background-position: 22px 16px;"></div></div></a>
<div id="page_body">
<div id="page_content">



<table>
<tr>
<td valign=top>
	<ul id="menu">
	<li class="subtitle">Quilt</li>
		<li><a href="index.html">Home</a></li>
		<li><a href="licence.html">Licence</a></li>
		<li><a href="version.html">Version History</a></li>
	<li class="subtitle">Using Quilt</li>
		<li><a href="xcode.html">Using Xcode</a></li>
		<li><a href="visualstudio.html">Using Visual Studio</a></li>
	</ul>
</td>
<td valign=top>



<h1>Using Xcode</h1>
<h2>1. Configure Environment</h2>
<p>
Since Xcode invokes shell scripts with a reduced path, Quilt requires a source tree called
<tt>Qt</tt> that points to the root of your Qt installation.
</p>

<div align=center>
<a href="img/xcode_env.png" class="plain"><img src="img/xcode_env.png" class="width450"></a>
</div>



<h2>2. Create Target</h2>
<p>
Create a new "Quilt" target in your project, and add this as a dependency of your main target.
</p>

<p>
The Quilt target should contain a Run Script build phase which performs:
</p>

<div class="box_code_yellow">quilt.rb --moc  --in="${PROJECT_DIR}/../Source"
               --out="${PROJECT_DIR}/../Source/QtGlue.moc"
</div>

<p>
For example:
</p>

<div align=center>
<a href="img/xcode_target.png" class="plain"><img src="img/xcode_target.png" class="width450"></a>
</div>

<p>
The <tt>--in</tt> parameter controls the directory to scan for files that contain Q_OBJECT
definitions, and the <tt>--out</tt> parameter indicates where to save the list of files that
require moccing (this file must have a <tt>.moc</tt> extension).
</p>

<p>
A <tt>--exclude</tt> parameter can also be supplied, which defines a regexp to filter the
scanned files (e.g., "--exclude=Win*" will exclude any files starting with "Win").
</p>



<h2>3. Create Rule</h2>
<p>
Create a new Build Rule in the main target.
</p>

<p>
This rule should match files with:
</p>

<div class="box_code_yellow">*.[mqu][ori]*
</div>

<p>
Unfortunately Xcode does not support alternation within globbing, however this will match
<tt>.moc</tt>/<tt>.qrc</tt>/<tt>.ui</tt> extensions.
</p>

<p>
This rule should process files with:

<div class="box_code_yellow">quilt.rb --build  --in="${INPUT_FILE_PATH}"
                 --out="${DERIVED_FILES_DIR}/
                        ${INPUT_FILE_BASE}_${CURRENT_ARCH}.cpp"
</div>

<p>
and output to:
</p>

<div class="box_code_yellow">${DERIVED_FILES_DIR}/${INPUT_FILE_BASE}_${CURRENT_ARCH}.cpp
</div>

<p>
For example:
</p>

<div align=center>
<a href="img/xcode_rule.png" class="plain"><img src="img/xcode_rule.png" class="width450"></a>
</div>



<h2>4. Add Source</h2>
<p>
Create an empty text file as your <tt>QtGlue.moc</tt> file, and add it to the main target.
</p>

<p>
After adding this file, drag it from the "Copy Bundle Resources" phase of the main target
into the "Compile Sources" phase.
</p>

<p>
If you have any <tt>.qrc</tt> or <tt>.ui</tt> files, these should also be added to the project.
</p>



<h2>How It Works</h2>
<ol>
<li>
	<p>
	The Quilt target invokes quilt to update the <tt>.moc</tt> file, before Xcode performs
	dependency checking for the main target.
	</p>
	
	<p>
	This must be done from a separate target, since Run Script phases are invoked after
	dependency checking and Quilt must run before the main target performs this check.
	</p>
	
	<p>
	Quilt will automatically detect any files that require preprocessing, and add them
	to the <tt>.moc</tt> file.
	</p>
</li>


<li>
	<p>
	The main target's build rule will invoke quilt for any <tt>.moc</tt>, <tt>.qrc</tt>, or
	<tt>.ui</tt> files in the target.
	</p>

	<p>
	Quilt will then invoke the appropriate meta-compiler, and generate derived source
	files within the project's build folder.
	</p>
</li>


<li>
	<p>
	Xcode will compile the derived source files during the build, and include their
	object code when linking.
	</p>
</li>
</ol>





</td>
</tr>
</table>



</div>
</div>
<div id="page_footer"></div>
</div>



<!--FOOTER_BEGIN-->
<div id="footer">
Copyright &copy; 2006-2010 <a href="http://www.refnum.com/">refNum Software</a>
</div>
<!--FOOTER_END-->
</body>
</html>
